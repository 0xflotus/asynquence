/*! asynquence
    v0.2.0-a (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
!function(n,t){"undefined"!=typeof module&&module.exports?module.exports=t(require(n)):"function"==typeof define&&define.amd?define([n],t):t(n)}(this.ASQ||"./asq.src.js",function(n){"use strict";var t=Array.prototype.slice,a=Object.create(null);return n.extend("all",function(n){return n.gate}),n.extend("any",function(e,r){return function(){if(r("seq_error")||r("seq_aborted")||0===arguments.length)return e;var u=t.call(arguments);return e.then(function(e){function r(){var n;l===u.length&&(n=[],s?(u.forEach(function(t,a){n.push(o["s"+a])}),e.apply(a,n)):(u.forEach(function(t,a){n.push(c["s"+a])}),e.fail.apply(a,n)))}var s=!1,l=0,o={},c={},p=n.apply(a,t.call(arguments,1));u=u.map(function(u,p){return function(f){var i=t.call(arguments);i[0]=function(){s=!0,l++,o["s"+p]=arguments.length>1?n.messages.apply(a,arguments):arguments[0],r()},i[0].fail=function(){l++,c["s"+p]=arguments.length>1?n.messages.apply(a,arguments):arguments[0],r()},i[0].abort=function(){s||(f.abort(),e.abort())},u.apply(a,i)}}),p.gate.apply(a,u)}),e}}),n.extend("first",function(e,r){return function(){if(r("seq_error")||r("seq_aborted")||0===arguments.length)return e;var u=t.call(arguments);return e.then(function(e){var r=0,s={},l=!1,o=n.apply(a,t.call(arguments,1));u=u.map(function(c,p){return function(f){var i=t.call(arguments);i[0]=function(){l||(l=!0,r++,e(arguments.length>1?n.messages.apply(a,arguments):arguments[0]),o.abort())},i[0].fail=function(){var t=[];r++,s["s"+p]=arguments.length>1?n.messages.apply(a,arguments):arguments[0],l||r!==u.length||(u.forEach(function(n,a){t.push(s["s"+a])}),e.fail.apply(a,t))},i[0].abort=function(){l||(f.abort(),e.abort())},c.apply(a,i)}}),o.gate.apply(a,u)}),e}}),n.extend("last",function(e,r){return function(){if(r("seq_error")||r("seq_aborted")||0===arguments.length)return e;var u=t.call(arguments);return e.then(function(e){function r(){var n;l===u.length&&(n=[],s?e(o):(u.forEach(function(t,a){n.push(c["s"+a])}),e.fail.apply(a,n)))}var s=!1,l=0,o={},c={},p=n.apply(a,t.call(arguments,1));u=u.map(function(u,p){return function(f){var i=t.call(arguments);i[0]=function(){s=!0,l++,o=arguments.length>1?n.messages.apply(a,arguments):arguments[0],r()},i[0].fail=function(){l++,c["s"+p]=arguments.length>1?n.messages.apply(a,arguments):arguments[0],r()},i[0].abort=function(){s||(f.abort(),e.abort())},u.apply(a,i)}}),p.gate.apply(a,u)}),e}}),n.extend("none",function(e,r){return function(){if(r("seq_error")||r("seq_aborted")||0===arguments.length)return e;var u=t.call(arguments);return e.then(function(e){function r(){var n;l===u.length&&(n=[],s?(u.forEach(function(t,a){n.push(o["s"+a])}),e.fail.apply(a,n)):(u.forEach(function(t,a){n.push(c["s"+a])}),e.apply(a,n)))}var s=!1,l=0,o={},c={},p=n.apply(a,t.call(arguments,1));u=u.map(function(u,p){return function(f){var i=t.call(arguments);i[0]=function(){s=!0,l++,o["s"+p]=arguments.length>1?n.messages.apply(a,arguments):arguments[0],r()},i[0].fail=function(){l++,c["s"+p]=arguments.length>1?n.messages.apply(a,arguments):arguments[0],r()},i[0].abort=function(){s||(f.abort(),e.abort())},u.apply(a,i)}}),p.gate.apply(a,u)}),e}}),n.extend("try",function(e,r){return function(){if(r("seq_error")||r("seq_aborted")||0===arguments.length)return e;var u=t.call(arguments).map(function(e){return function(r){var u=t.call(arguments),s=n.apply(a,u.slice(1));s.then(function(){e.apply(a,arguments)}).val(function(){r.apply(a,arguments)}).or(function(){var t=n.messages.apply(a,arguments);r({"catch":t.length>1?t:t[0]})})}});return e.then.apply(a,u),e}}),n.extend("until",function(e,r){return function(){if(r("seq_error")||r("seq_aborted")||0===arguments.length)return e;var u=t.call(arguments).map(function(e){return function r(u){var s=t.call(arguments),l=n.apply(a,s.slice(1));l.then(function(){var n=t.call(arguments);n[0].break=function(){u.fail.apply(a,arguments),l.abort()},e.apply(a,n)}).val(function(){u.apply(a,arguments)}).or(function(){r.apply(a,s)})}});return e.then.apply(a,u),e}}),{}});
