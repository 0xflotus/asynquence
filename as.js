/*! asyncSteps.js
    v0.1 (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
(function(l){var r=l.$AS;function o(a){return Object.prototype.toString.call(a)=="[object Array]"}function s(a){for(var b=0;b<a.length;){if(o(a[b])){a.splice.apply(a,[b,1].concat(a[b]));continue}b++}return a}function p(){var m;m=function(){function q(){var g,e,f;if(k.length){f=c.slice();c=[];g=k.shift();h=$AG();for(e=0;e<g.length;e++){(function(d){h.and(function(a){var b=f.slice();b.unshift(a);d.apply(d,b)})})(g[e])}h.then(t).or(u);f=null}else h=null}function v(){var a;k=true;if(i!==true&&i.length){while(a=i.shift()){if(c.length>0){a.apply({},c);c=[]}else a.call({})}}i=true;h=null}function t(){var a=[].slice.call(arguments),b;if(!n){if(arguments.length){for(b=0;b<a.length;b++){if(o(a[b])&&a[b].length==1)c.push(a[b][0]);else c.push(a[b])}}console.log("gate_finish: "+JSON.stringify(c));q()}}function u(){var a=[].slice.call(arguments),b;if(!n){n=true;if(arguments.length){for(b=0;b<a.length;b++){if(o(a[b])&&a[b].length==1)c.push(a[b][0]);else c.push(a[b])}}console.log("gate_error: "+JSON.stringify(c));v()}}function w(){var g=$AG(),e=g.and(),f;f=function(){var b=[].slice.call(arguments),d;d=function(a){a.apply({},b)};d.__wrapper__=true;e(d)};f.fail=function(){var b=[].slice.call(arguments),d;d=function(a){a.fail.apply({},b)};d.__wrapper__=true;e(d)};g.and(function(b){k.push([function(a){b(a)}])}).then(function(a,b){var d;a=a[0];b=b[0];if(!a.__wrapper__){d=a;a=b;b=d}a(b)});return f}var j,h,k=[],i=[],c=[],n=false;j={then:function(){if(n)return j;var a=s([].slice.call(arguments)),b;if(a.length==0){b=w()}else{k.push(a);b=j}if(!h){q()}return b},or:function(a){if(i!==true){i.push(a)}else{a.apply({},c);c=[]}return j}};if(arguments.length>0)j.then.apply({},arguments);return j};m.noConflict=function(){var a=l.$AS;l.$AS=r;return a};m.sandbox=function(){return p()};return m}l.$AS=p()})(this);