/*! asyncSteps.js
    v0.2 (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
(function(m){var s=m.$AS;function p(a){return Object.prototype.toString.call(a)=="[object Array]"}function t(a){for(var b=0;b<a.length;){if(p(a[b])){a.splice.apply(a,[b,1].concat(a[b]));continue}b++}return a}function q(){var n;n=function(){function r(){var k,i,g;if(j)return;if(l.length){g=d.slice();d=[];k=l.shift();e=$AG();for(i=0;i<k.length;i++){(function(c){e.and(function(a){var b=g.slice();a.abort=function(){f.abort()};b.unshift(a);c.apply(c,b)})})(k[i])}e.then(u).or(v);g=null}else{e.abort();e=null}}function w(){var a;if(j)return;l=true;if(h!==true&&h.length){while(h&&(a=h.shift())){if(d.length>0){a.apply({},d);d=[]}else a.call({})}}h=true;e.abort();e=null}function u(){var a=[].slice.call(arguments),b;if(!(o||j)){if(arguments.length){for(b=0;b<a.length;b++){if(p(a[b])&&a[b].length==1)d.push(a[b][0]);else d.push(a[b])}}r()}}function v(){var a=[].slice.call(arguments),b;if(!(o||j)){o=true;if(arguments.length){for(b=0;b<a.length;b++){if(p(a[b])&&a[b].length==1)d.push(a[b][0]);else d.push(a[b])}}w()}}function x(){var k=$AG(),i=k.and(),g;g=function(){var b=[].slice.call(arguments),c;c=function(a){a.apply({},b)};c.__wrapper__=true;i(c)};g.fail=function(){var b=[].slice.call(arguments),c;c=function(a){a.fail.apply({},b)};c.__wrapper__=true;i(c)};g.abort=function(){f.abort()};k.and(function(b){l.push([function(a){b(a)}])}).then(function(a,b){var c;a=a[0];b=b[0];if(!a.__wrapper__){c=a;a=b;b=c}a(b)});return g}var f,e,l=[],h=[],d=[],o=false,j=false;f={then:function(){if(o||j)return f;var a=t([].slice.call(arguments)),b;if(a.length==0){b=x()}else{l.push(a);b=f}if(!e){r()}return b},or:function(a){if(j)return f;if(h!==true){h.push(a)}else{a.apply({},d);d=[]}return f},abort:function(){j=false;if(e)e.abort();e=l=h=d=null}};if(arguments.length>0)f.then.apply({},arguments);return f};n.noConflict=function(){var a=m.$AS;m.$AS=s;return a};n.sandbox=function(){return q()};return n}m.$AS=q()})(this);