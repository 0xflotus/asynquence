/*! asynquence
    v0.2.0-a (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
!function(n,t,e){"undefined"!=typeof module&&module.exports?module.exports=e():"function"==typeof define&&define.amd?define(e):t[n]=e(n,t)}("ASQ",this,function(n,t){function e(n){return"undefined"!=typeof setImmediate?setImmediate(n):setTimeout(n,0)}function u(){function n(){clearTimeout(E),E=null,T.length=0,k.length=0,q.length=0,x.length=0}function t(){return j?u():(E||(E=e(u)),void 0)}function u(){var e,u;if(E=null,j)n();else if(_)for(;k.length;){e=k.shift();try{e.apply(h,x)}catch(r){l(r)?x=x.concat(r):(x.push(r),r.stack&&x.push(r.stack)),0===k.length&&console.error.apply(console,x)}}else if(S&&T.length>0){S=!1,e=T.shift(),u=q.slice(),q.length=0,u.unshift(a());try{e.apply(h,u)}catch(r){l(r)?x=x.concat(r):x.push(r),_=!0,t()}}}function a(){function n(){_||j||S||(S=!0,q.push.apply(q,arguments),x.length=0,t())}return n.fail=function(){_||j||S||(_=!0,q.length=0,x.push.apply(x,arguments),t())},n.abort=function(){_||j||(S=!1,j=!0,q.length=0,x.length=0,t())},n}function s(n,t,u){function r(){clearTimeout(y),y=A=E=m=null}function a(){return v?i():(y||(y=e(i)),void 0)}function i(){if(!(_||j||b)){var t=[];y=null,d?(n.fail.apply(h,m),r()):v?(n.abort(),r()):c()&&(b=!0,A.forEach(function(n,e){t.push(E["s"+e])}),n.apply(h,t),r())}}function c(){if(!(_||j||d||v||b||0===A.length)){var n=!0;return A.some(function(t){return null===t?(n=!1,!0):void 0}),n}}function o(){function n(){if(!(_||j||d||v||b||A[t])){var n=f.messages.apply(h,arguments);E["s"+t]=n.length>1?n:n[0],A[t]=!0,a()}}var t=A.length;return n.fail=function(){_||j||d||v||b||A[t]||(d=!0,m=p.call(arguments),a())},n.abort=function(){_||j||d||v||b||(v=!0,i())},A[t]=null,n}var s,g,m,y,d=!1,v=!1,b=!1,A=[],E={};t.some(function(n){if(d||v)return!0;s=u.slice(),s.unshift(o());try{n.apply(h,s)}catch(t){return g=t,d=!0,!0}}),g&&(l(g)?n.fail.apply(h,g):n.fail(g))}function g(){return _||j||0===arguments.length?I:(T.push.apply(T,o(arguments,c)),t(),I)}function m(){return j||0===arguments.length?I:(k.push.apply(k,arguments),t(),I)}function y(){if(_||j||0===arguments.length)return I;var n=p.call(arguments);return g(function(t){var e=p.call(arguments,1);s(t,n,e)}),I}function d(){return j||0===arguments.length?I:(p.call(arguments).forEach(function(n){g(function(t){n.apply(h,p.call(arguments,1)),t()}).or(n.fail)}),I)}function v(){return _||j||0===arguments.length?I:(p.call(arguments).forEach(function(n){g(function(t){l(n)||(n=n.apply(h,p.call(arguments,1))),n.pipe(t)})}),I)}function b(){return _||j||0===arguments.length?I:(p.call(o(arguments,i)).forEach(function(n){g(function(t){var e=n.apply(h,p.call(arguments,1));l(e)||(e=f.messages(e)),t.apply(h,e)})}),I)}function A(){return _?I:(j=!0,u(),I)}var E,_=!1,j=!1,S=!0,T=[],k=[],q=[],x=[],I=r({then:g,or:m,gate:y,pipe:d,seq:v,val:b,abort:A});return I.then.apply(h,o(arguments,c)),I}function r(n){return Object.defineProperty(n,g,{enumerable:!1,value:!0}),n}function l(n){return null!=n&&"object"==typeof n&&n[g]}function a(n,t){return p.call(t).slice(1,n+1)}function i(n){return f.messages.apply(h,a(n,arguments))}function c(n){arguments[n+1].apply(h,a(n,arguments))}function o(n,t){var e,u;for(n=p.call(n),e=0;e<n.length;e++)if(Array.isArray(n[e])&&l(n[e]))n[e]=t.bind.apply(t,[null,n[e].length].concat(n[e]));else if("function"!=typeof n[e]){for(u=e+1;u<n.length&&("function"!=typeof n[u]&&!l(n[u]));u++);n.splice(e,u-e,t.bind.apply(t,[null,u-e].concat(n.slice(e,u))))}return n}var f,s=(t||{})[n],p=Array.prototype.slice,g="__ASQ__",h=Object.create(null);return f=u,f.messages=function(){var n=p.call(arguments);return r(n),n},f.isMessageWrapper=f.isSequence=l,f.noConflict=function(){return t&&(t[n]=s),f},f});
