/*! asynquence
    v0.1.2-a (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
(function(e,t,n){typeof module!="undefined"&&module.exports?module.exports=n():typeof define=="function"&&define.amd?define(n):t[e]=n(e,t)})("ASQ",this,function(e,t){function s(e){return typeof setImmediate!="undefined"?setImmediate(e):setTimeout(e,0)}function o(){function e(){function e(){clearTimeout(E),E=null,g.length=0,y.length=0,b.length=0,w.length=0}function t(){if(v)return n();E||(E=s(n))}function n(){var n,i;E=null;if(v)e();else if(d)while(y.length){n=y.shift();try{n.apply(n,w)}catch(s){w.push(s),s.stack&&w.push(s.stack),y.length===0&&console.error.apply(console,w)}}else if(m&&g.length>0){m=!1,n=g.shift(),i=b.slice(),b.length=0,i.unshift(r());try{n.apply(n,i)}catch(s){w.push(s),d=!0,t()}}}function r(){function e(){if(d||v||m)return;m=!0,b.push.apply(b,arguments),w.length=0,t()}return e.fail=function(){if(d||v||m)return;d=!0,b.length=0,w.push.apply(w,arguments),t()},e.abort=function(){if(d||v)return;m=!1,v=!0,b.length=0,w.length=0,t()},e}function o(e,t,n){function r(){clearTimeout(w),w=g=y=b=null}function o(){if(c)return u();w||(w=s(u))}function u(){if(d||v||h)return;var t=[];w=null,l?(e.fail.apply(e,b),r()):c?(e.abort(),r()):a()&&(h=!0,g.forEach(function(e,n){t.push(y["m"+n])}),e.apply(e,t),r())}function a(){if(d||v||l||c||h||g.length===0)return;var e=!0;return g.some(function(t){if(t===null)return e=!1,!0}),e}function f(){function e(){if(d||v||l||c||h||g[t])return;var e=i.call(arguments);y["m"+t]=e.length>1?e:e[0],g[t]=!0,o()}var t=g.length;return e.fail=function(){if(d||v||l||c||h||g[t])return;l=!0,b=i.call(arguments),o()},e.abort=function(){if(d||v||l||c||h)return;c=!0,u()},g[t]=null,e}var l=!1,c=!1,h=!1,p,m,g=[],y={},b,w;t.some(function(e){if(l||c)return!0;p=n.slice(),p.unshift(f());try{e.apply(e,p)}catch(t){return m=t,l=!0,!0}}),m&&e.fail(m)}function u(){return d||v?S:(arguments.length>0&&g.push.apply(g,arguments),t(),S)}function a(){return v?S:(y.push.apply(y,arguments),t(),S)}function f(){if(d||v||arguments.length===0)return S;var e=i.call(arguments);return u(function(t){var n=i.call(arguments,1);o(t,e,n)}),S}function l(){return d||v||arguments.length===0?S:(i.call(arguments).forEach(function(e){u(function(t){e.apply(e,i.call(arguments,1)),t()}).or(e.fail)}),S)}function c(){return d||v||arguments.length===0?S:(i.call(arguments).forEach(function(e){u(function(t){e.apply(e,i.call(arguments,1)).pipe(t)})}),S)}function h(){return d||v||arguments.length===0?S:(i.call(arguments).forEach(function(e){u(function(t){t(e.apply(e,i.call(arguments,1)))})}),S)}function p(){return d?S:(v=!0,n(),S)}var d=!1,v=!1,m=!0,g=[],y=[],b=[],w=[],E,S={then:u,or:a,gate:f,pipe:l,seq:c,val:h,abort:p};return arguments.length>0&&S.then.apply(S,arguments),S}return e}var n,r=(t||{})[e],i=Array.prototype.slice;return n=o(),n.noConflict=function(){return t&&(t[e]=r),n},n});
