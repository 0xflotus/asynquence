/*! asynquence
    v0.2.0-a (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
(function(e,t,n){typeof module!="undefined"&&module.exports?module.exports=n():typeof define=="function"&&define.amd?define(n):t[e]=n(e,t)})("ASQ",this,function(e,t){function s(e){return typeof setImmediate!="undefined"?setImmediate(e):setTimeout(e,0)}function o(){function e(){function e(){clearTimeout(x),x=null,b.length=0,w.length=0,E.length=0,S.length=0}function t(){if(g)return r();x||(x=s(r))}function r(){var n,r;x=null;if(g)e();else if(m)while(w.length){n=w.shift();try{n.apply(n,S)}catch(i){u(i)?S=S.concat(i):(S.push(i),i.stack&&S.push(i.stack)),w.length===0&&console.error.apply(console,S)}}else if(y&&b.length>0){y=!1,n=b.shift(),r=E.slice(),E.length=0,r.unshift(o());try{n.apply(n,r)}catch(i){u(i)?S=S.concat(i):S.push(i),m=!0,t()}}}function o(){function e(){if(m||g||y)return;y=!0,E.push.apply(E,arguments),S.length=0,t()}return e.fail=function(){if(m||g||y)return;m=!0,E.length=0,S.push.apply(S,arguments),t()},e.abort=function(){if(m||g)return;y=!1,g=!0,E.length=0,S.length=0,t()},e}function a(e,t,r){function o(){clearTimeout(S),S=b=w=E=null}function a(){if(p)return f();S||(S=s(f))}function f(){if(m||g||d)return;var t=[];S=null,h?(e.fail.apply(e,E),o()):p?(e.abort(),o()):l()&&(d=!0,b.forEach(function(e,n){t.push(w["s"+n])}),e.apply(e,t),o())}function l(){if(m||g||h||p||d||b.length===0)return;var e=!0;return b.some(function(t){if(t===null)return e=!1,!0}),e}function c(){function e(){if(m||g||h||p||d||b[t])return;var e=n.messages.apply(null,arguments);w["s"+t]=e.length>1?e:e[0],b[t]=!0,a()}var t=b.length;return e.fail=function(){if(m||g||h||p||d||b[t])return;h=!0,E=i.call(arguments),a()},e.abort=function(){if(m||g||h||p||d)return;p=!0,f()},b[t]=null,e}var h=!1,p=!1,d=!1,v,y,b=[],w={},E,S;t.some(function(e){if(h||p)return!0;v=r.slice(),v.unshift(c());try{e.apply(e,v)}catch(t){return y=t,h=!0,!0}}),y&&(u(y)?e.fail.apply(null,y):e.fail(y))}function f(){return m||g||arguments.length===0?T:(b.push.apply(b,arguments),t(),T)}function l(){return g||arguments.length===0?T:(w.push.apply(w,arguments),t(),T)}function c(){if(m||g||arguments.length===0)return T;var e=i.call(arguments);return f(function(t){var n=i.call(arguments,1);a(t,e,n)}),T}function h(){return g||arguments.length===0?T:(i.call(arguments).forEach(function(e){f(function(t){e.apply(e,i.call(arguments,1)),t()}).or(e.fail)}),T)}function p(){return m||g||arguments.length===0?T:(i.call(arguments).forEach(function(e){f(function(t){u(e)||(e=e.apply(e,i.call(arguments,1))),e.pipe(t)})}),T)}function d(){return m||g||arguments.length===0?T:(i.call(arguments).forEach(function(e){f(function(t){var r=e.apply(e,i.call(arguments,1));u(r)||(r=n.messages.call(null,r)),t.apply(t,r)})}),T)}function v(){return m?T:(g=!0,r(),T)}var m=!1,g=!1,y=!0,b=[],w=[],E=[],S=[],x,T={then:f,or:l,gate:c,pipe:h,seq:p,val:d,abort:v};return arguments.length>0&&T.then.apply(T,arguments),Object.defineProperty(T,"__ASQ__",{enumerable:!1,value:!0}),T}return e}function u(e){return typeof e=="object"&&e.__ASQ__}var n,r=(t||{})[e],i=Array.prototype.slice;return n=o(),n.messages=function(){var e=i.call(arguments);return Object.defineProperty(e,"__ASQ__",{enumerable:!1,value:!0}),e},n.isMessageWrapper=n.isSequence=u,n.noConflict=function(){return t&&(t[e]=r),n},n});
